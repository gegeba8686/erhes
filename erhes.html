<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>–ö–∞—Ä–≥–æ - –ò–ª–≥—ç—ç–º–∂ —à–∞–ª–≥–∞—Ö & –ê–¥–º–∏–Ω</title>
<style>
:root{--bg:#0f1226;--panel:#161a35;--soft:#202553;--text:#eef1ff;--muted:#b9c3ff;--accent1:#6e8bff;--accent2:#ff6ad5;--radius:12px;}
*{box-sizing:border-box}body{margin:0;font-family:Inter,sans-serif;background:linear-gradient(180deg,#0f1226 0%,#071028 100%);color:var(--text);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
header{background:linear-gradient(90deg,var(--accent1),var(--accent2));padding:18px 24px;box-shadow:0 6px 24px rgba(0,0,0,0.45)}
.container{max-width:1200px;margin:20px auto;padding:18px}
.brand{display:flex;align-items:center;gap:12px;font-weight:700}
.logo{width:44px;height:44px;border-radius:10px;background:conic-gradient(from 180deg,var(--accent2),var(--accent1));box-shadow:0 6px 18px rgba(110,139,255,0.12)}
nav{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.tab{background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
.tab.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#041428;font-weight:700}
main{display:grid;grid-template-columns:1fr;gap:18px;margin-top:18px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:18px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.4)}
h1,h2{margin:0 0 10px 0}
.lead{color:var(--muted);margin-bottom:12px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.grow{flex:1 1 220px}
input, select, textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:#0b1230;color:var(--text);outline:none}
input::placeholder{color:#93a0ff55}
button{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;background:var(--panel);color:var(--text);box-shadow:0 8px 20px rgba(0,0,0,0.45)}
button.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#041428;font-weight:700}
table{width:100%;border-collapse:collapse;margin-top:12px;border-radius:10px;overflow:hidden}
th,td{padding:10px 12px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.04)}
th{background:rgba(255,255,255,0.03);font-weight:700}
.muted{color:var(--muted)}
.small{font-size:13px}
.hidden{display:none}
.clickable-row{cursor:pointer}
.collapse-content{display:none;padding-top:8px}
footer{margin-top:20px;color:var(--muted);text-align:center;padding:18px 4px}
@media(min-width:900px){main{grid-template-columns:1fr 1fr}}
.collapsible-btn {
  width: 100%;
  text-align: left;
  background: linear-gradient(90deg,#6e8bff,#ff6ad5);
  color: #041428;
  padding: 12px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-size: 16px;
}

.collapsible-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.35s ease;
  padding: 0 12px;
  background: rgba(255,255,255,0.02);
  border-radius: 0 0 10px 10px;
  margin-bottom: 12px;
}

.collapsible-content p, .collapsible-content ul {
  margin: 8px 0;
  color: #b9c3ff;
}

</style>
</head>
<body>
<header>
<div class="container">
<div class="brand">
<div class="logo" aria-hidden="true"></div>
<div><div style="font-size:18px">–≠—Ä—Ö—ç—Å –ö–∞—Ä–≥–æ</div><div class="small muted">–ò–ª–≥—ç—ç–º–∂ —à–∞–ª–≥–∞—Ö ¬∑ –ê–¥–º–∏–Ω (Local demo)</div></div>
</div>
<nav style="margin-top:12px">
<button id="tabUser" class="tab active">–•—ç—Ä—ç–≥–ª—ç–≥—á</button>
<button id="tabAdmin" class="tab">–ê–¥–º–∏–Ω</button>
</nav>
</div>
</header>
<main class="container">
<!-- USER -->
<section id="userPanel" class="card">
<h2>üì¶ –ò–ª–≥—ç—ç–º–∂ —à–∞–ª–≥–∞—Ö</h2>
<p class="lead">–£—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä–∞–∞ –æ—Ä—É—É–ª–∞–∞–¥ —Ç—É—Ö–∞–π–Ω –¥—É–≥–∞–∞—Ä—Ç –±“Ø—Ä—Ç–≥—ç–ª—Ç—ç–π –∏–ª–≥—ç—ç–º–∂“Ø“Ø–¥–∏–π–≥ —Ö–∞—Ä–∞–∞—Ä–∞–π.</p>
<div class="row" style="margin-top:8px">
<input id="uPhone" class="grow" placeholder="–£—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä (–∂: 99112233)" inputmode="numeric"/>
<button id="uSearchBtn" class="primary">–®–∞–ª–≥–∞—Ö</button>
</div>
<div id="userSummary" style="margin-top:12px"></div>
<div id="userResults" style="margin-top:12px"></div>

<!-- Collapse Cards -->
<div class="card collapsible">
  <button class="collapsible-btn">üì¶Taobao —Ö–∞—è–≥ —Ö–æ–ª–±–æ—Ö</button>
  <div class="collapsible-content">
    <p>–•–∞—è–≥–∞–∞ —Ö–æ–ª–±–æ–æ–¥ —á–∞—Ç–∞–∞—Ä –∑–∞–∞–≤–∞–ª —à–∞–ª–≥—É—É–ª–∞–∞—Ä–∞–π:</p>
    <ul>
      <li>–ë“Ø—Å –Ω—É—Ç–∞–≥: ÂÜÖËíôÂè§Ëá™Ê≤ªÂå∫ ‚Üí Èî°ÊûóÈÉ≠ÂãíÁõü ‚Üí ‰∫åËøûÊµ©ÁâπÂ∏Ç</li>
      <li>–ù–∞—Ä–∏–π–Ω —Ö–∞—è–≥: –≠—Ä—ç—ç–Ω –¥—ç—Ö —Ö–∞—è–≥ YARMAG + ”©”©—Ä–∏–π–Ω –Ω—ç—Ä + —É—Ç–∞—Å</li>
      <li>–•—è—Ç–∞–¥ —É—Ç–∞—Å: 15547926009</li>
    </ul>
  </div>
</div>

<div class="card collapsible">
  <button class="collapsible-btn">üì¶“Æ–Ω—ç —Ç–∞—Ä–∏—Ñ</button>
  <div class="collapsible-content">
    <ul>
      <li>–≠—Ä—ç—ç–Ω - –£–ë —Ç—ç—ç–≤—ç—Ä: 1–º¬≤ = 300,000-350,000‚ÇÆ</li>
        <li>0-100–≥—Ä –≥ –±–∞—Ä–∞–∞: 1000‚ÇÆ</li>
        <li>100–≥—Ä-1000–≥—Ä –±–∞—Ä–∞–∞: 2000‚ÇÆ</li>
        <li>+1–∫–≥ —Ç—É—Ç–∞–º–¥: 2500‚ÇÆ-—Å</li>
        <li>–û–≤–æ—Ä –±–∞–≥–∞—Ç–∞–π —Ö“Ø–Ω–¥ –∞—á–∞–∞–≥ –∂–∏–Ω–≥—ç—ç—Ä —Ç–æ–æ—Ü–Ω–æ, –û–≤–æ—Ä –∏—Ö—Ç—ç–π —Ö”©–Ω–≥”©–Ω –∞—á–∞–∞–≥ –æ–≤—Ä–æ–æ—Ä —Ç–æ–æ—Ü–Ω–æ.</li>
    </ul>
  </div>
</div>


<div class="card collapsible">
  <button class="collapsible-btn">üì¶–•–∞—è–≥ –±–∞–π—Ä—à–∏–ª</button>
  <div class="collapsible-content">
    <ul>
   <p>–Ø–∞—Ä–º–∞–≥ –®“Ø–Ω—à–∏–≥ –≤–∏–ª–ª–∞ 2 —Ö–æ—Ç—Ö–æ–Ω 61–∞ –±–∞–π—Ä
        ‚òéÔ∏è 86869035</p>
    </ul>
  </div>
</div>


<div class="card collapsible">
  <button class="collapsible-btn">üì¶–ê–Ω—Ö–∞–∞—Ä–∞—Ö –∑“Ø–π–ª—Å</button>
  <div class="collapsible-content">
    <ul>
   <li>–•–æ—Ä–∏–æ—Ç–æ–π –±–∞—Ä–∞–∞ —Ç—ç—ç–≤—ç—Ä–ª—ç—Ö–≥“Ø–π. “Æ“Ø–Ω–¥: –ê–º–∞—Ä—Ö–∞–Ω –º—É—É–¥–∞—Ö, —Ö–∞–≥–∞—Ä–∞—Ö, —Ö”©–ª–¥”©—Ö, —à–∏–Ω–≥—ç–Ω –∑“Ø–π–ª—Å, —Ç—ç—Å—ç—Ä—á –¥—ç–ª–±—ç—Ä—ç—Ö –±–æ–¥–∏—Å, –∞–º—å–¥ –∞–º—å—Ç–∞–Ω –±–æ–ª–æ–Ω —Ö–∏–ª –≥–∞–∞–ª–∏–π–Ω —Ç—É—Ö–∞–π —Ö—É—É–ª—å–¥ –∑–∞–∞—Å–∞–Ω –±—É—Å–∞–¥ —Ö–æ—Ä–∏–æ—Ç–æ–π –±–∞—Ä–∞–∞
</li>
        <li>–¢—ç—ç–≤—ç—Ä–ª—ç—Ö —Ö—É–≥–∞—Ü–∞–∞:  —ç—Ä—ç—ç–Ω–¥ —Ö“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω —Ç”©–ª”©–≤ –æ—Ä—Å–æ–Ω ”©–¥—Ä”©”©—Å —Ö–æ–π—à 3-5 —Ö–æ–Ω–æ–≥—Ç –∏—Ä–Ω—ç.</li>
    </ul>
  </div>
</div>


<div class="card collapsible">
  <button class="collapsible-btn">üì¶–ó–∞–∞–≤–∞—Ä –ª–∏–Ω–∫“Ø“Ø–¥</button>
  <div class="collapsible-content">
    <ul>
           <li>–¢–∞–æ–±–∞–æ: <a href="https://www.facebook.com/permalink.php/?story_fbid=122105328320975224&id=61579256729397" target="_blank">–ª–∏–Ω–∫</a></li>
        <li>–ü–∏–Ω–¥—É–æ–¥—É–æ: <a href="https://www.facebook.com/story.php?story_fbid=122099671676975224&id=61579256729397&mibextid=wwXIfr&rdid=shUINXwtOzTfIlVv&share_url=https%3A%2F%2Fwww.facebook.com%2Fshare%2Fp%2F14HVchWcwH5%2F%3Fmibextid%3DwwXIfr" target="_blank">–ª–∏–Ω–∫</a></li>
      
    </ul>
  </div>
</div>
</section>

<!-- ADMIN -->
<section id="adminPanel" class="card" hidden>
<h2>üõ† –ê–¥–º–∏–Ω —Å–∞–º–±–∞—Ä</h2>
<p class="lead">–ù—ç–≤—Ç—Ä—ç—Ö –Ω—É—É—Ü: <code>admin123</code></p>
<div id="adminLogin" style="margin-top:6px">
<div class="row">
<input id="adminPass" class="grow" placeholder="–ù—É—É—Ü –∫–æ–¥" type="password"/>
<button id="adminLoginBtn" class="primary">–ù—ç–≤—Ç—Ä—ç—Ö</button>
</div>
</div>
<div id="adminArea" hidden style="margin-top:14px">
<div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
<input id="adminFilterPhone" placeholder="–£—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä (—à“Ø“Ø–ª—Ç)" style="flex:1"/>
<button id="adminFilterBtn" class="primary">üîç –®“Ø“Ø—Ö</button>
<button id="adminFilterClearBtn">–¶—ç–≤—ç—Ä–ª—ç—Ö</button>
</div>

<div class="card" style="padding:12px; margin-top:12px">
<div class="row">
<input id="aPhone" placeholder="–£—Ç–∞—Å–Ω—ã –¥—É–≥–∞–∞—Ä"/>
<input id="aTrack" placeholder="–¢—Ä–∞–∫ –∫–æ–¥"/>
</div>
<div class="row" style="margin-top:8px">
<input id="aPrice" placeholder="“Æ–Ω—ç (‚ÇÆ) ‚Äî –∑”©–≤—Ö”©–Ω '–ú–æ–Ω–≥–æ–ª–¥ –∏—Ä—Å—ç–Ω' “Ø–µ–¥" inputmode="numeric"/>
<input id="aQty" placeholder="–®–∏—Ä—Ö—ç–≥" inputmode="numeric"/>
<select id="aStatus" style="min-width:160px">
<option value="—ç—Ä—ç—ç–Ω–¥ –∏—Ä—Å—ç–Ω">—ç—Ä—ç—ç–Ω–¥ –∏—Ä—Å—ç–Ω</option>
<option value="–ú–æ–Ω–≥–æ–ª–¥ –∏—Ä—Å—ç–Ω">–ú–æ–Ω–≥–æ–ª–¥ –∏—Ä—Å—ç–Ω</option>
<option value="—Ö“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω">—Ö“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω</option>
</select>
</div>
<div class="row" style="margin-top:8px">
<input id="aDate" type="date"/>
<button id="addBtn" class="primary">‚ûï –ù—ç–º—ç—Ö</button>
<button id="clearBtn">–¶—ç–≤—ç—Ä–ª—ç—Ö</button>
<button id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
<input id="importFile" type="file" accept="application/json" hidden/>
<button id="importBtn">–ò–º–ø–æ—Ä—Ç</button>
</div>
<div id="adminMsg" style="margin-top:8px" class="muted small"></div>
</div>

<div>
<h3 style="margin:4px 0">–ë“Ø—Ö –±“Ø—Ä—Ç–≥—ç–ª</h3>
<div id="allTableWrap" class="card" style="padding:8px"></div>
</div>

<div style="margin-top:12px">
<h3 style="margin:4px 0">–•“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω –∏–ª–≥—ç—ç–º–∂</h3>
<div id="deliveredWrap" class="card" style="padding:8px"></div>
</div>
</div>
</section>
</main>

<footer>
<div class="container muted small">¬© <span id="yr"></span> –≠—Ä—Ö—ç—Å –ö–∞—Ä–≥–æ ¬∑ Demo (localStorage)</div>
</footer>

<script>
const KEY='cargo_demo_v3',PASS='admin123';
const $=(s)=>document.querySelector(s);
const fmt=new Intl.NumberFormat('mn-MN');

function loadDB(){try{return JSON.parse(localStorage.getItem(KEY))||{}}catch{return{}}}
function saveDB(db){localStorage.setItem(KEY,JSON.stringify(db))}
function ensureDB(){saveDB(loadDB())}

// Tabs
const tabUser=$('#tabUser'),tabAdmin=$('#tabAdmin');
const userPanel=$('#userPanel'),adminPanel=$('#adminPanel');
tabUser.addEventListener('click',()=>{tabUser.classList.add('active');tabAdmin.classList.remove('active');userPanel.hidden=false;adminPanel.hidden=true})
tabAdmin.addEventListener('click',()=>{tabAdmin.classList.add('active');tabUser.classList.remove('active');adminPanel.hidden=false;userPanel.hidden=true})

// Collapse
document.querySelectorAll('.clickable-row').forEach(c=>{
c.addEventListener('click',()=>{c.querySelector('.collapse-content').classList.toggle('hidden')})
c.addEventListener('touchstart',()=>{c.querySelector('.collapse-content').classList.toggle('hidden')})
})

// User search
const uPhone=$('#uPhone'),uSearchBtn=$('#uSearchBtn');
const userSummary=$('#userSummary'),userResults=$('#userResults');
uSearchBtn.addEventListener('click',()=>{renderUser(uPhone.value.trim())})

function renderUser(phone){
userSummary.innerHTML='';userResults.innerHTML='';
if(!phone) return;
const db=loadDB();const items=(db[phone]||[]).slice();
if(items.length===0){userResults.innerHTML='<div class="card muted small">–¢–∞–Ω—ã –¥—É–≥–∞–∞—Ä—Ç –∏–ª–≥—ç—ç–º–∂ –±“Ø—Ä—Ç–≥—ç–≥–¥—ç—ç–≥“Ø–π –±–∞–π–Ω–∞.</div>';return;}
const visible=items.filter(it=>it.status!=='—Ö“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω');
if(visible.length===0){userResults.innerHTML='<div class="card muted small">–¢–∞–Ω—ã –¥—É–≥–∞–∞—Ä—Ç –æ–¥–æ–æ–≥–æ–æ—Ä —Ö–∞—Ä–∞–≥–¥–∞—Ö –∏–ª–≥—ç—ç–º–∂ –∞–ª–≥–∞ –±–∞–π–Ω–∞.</div>';return;}
const totalQty=visible.reduce((s,x)=>s+Number(x.qty||0),0);
const totalAmt=visible.reduce((s,x)=>s+(Number(x.qty||0)*Number(x.price||0)),0);
userSummary.innerHTML=`<div class="card small muted">–ù–∏–π—Ç: <b>${totalQty}</b> —à–∏—Ä—Ö—ç–≥ ¬∑ –ù–∏–π—Ç –¥“Ø–Ω: <b>‚ÇÆ ${fmt.format(totalAmt)}</b></div>`;
const groups={};visible.forEach(i=>(groups[i.track]||=[]).push(i));
const html=Object.keys(groups).sort().map(track=>{const arr=groups[track];const qty=arr.reduce((s,x)=>s+Number(x.qty||0),0);const amt=arr.reduce((s,x)=>s+Number(x.qty||0)*Number(x.price||0),0);const rows=arr.map(it=>`<tr><td>${it.track}</td><td>${it.qty}</td><td>${it.price?'‚ÇÆ '+fmt.format(it.price):'-'}</td><td>${it.status}</td><td>${it.date}</td></tr>`).join('');return `<div class="card" style="padding:10px;margin-bottom:10px"><div style="display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:8px"><div><b>–¢—Ä–∞–∫:</b> ${track}</div><div class="small muted">–î—ç–¥ –¥“Ø–Ω: ‚ÇÆ ${fmt.format(amt)} / ${qty} —à–∏—Ä—Ö—ç–≥</div></div><table><thead><tr><th>–¢—Ä–∞–∫</th><th>–®–∏—Ä—Ö—ç–≥</th><th>“Æ–Ω—ç</th><th>–°—Ç–∞—Ç—É—Å</th><th>–û–≥–Ω–æ–æ</th></tr></thead><tbody>${rows}</tbody></table></div>`}).join('');
userResults.innerHTML=html;
}
document.querySelectorAll('.collapsible-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const content = btn.nextElementSibling;
    if(content.style.maxHeight){
      content.style.maxHeight = null; // —Ö–∞–∞—Ö
    } else {
      content.style.maxHeight = content.scrollHeight + "px"; // –Ω—ç—ç—Ö
    }
  });
});

// Admin login & actions
const adminLoginBtn=$('#adminLoginBtn'),adminPass=$('#adminPass'),adminArea=$('#adminArea');
const aPhone=$('#aPhone'),aTrack=$('#aTrack'),aPrice=$('#aPrice'),aQty=$('#aQty'),aStatus=$('#aStatus'),aDate=$('#aDate');
const addBtn=$('#addBtn'),clearBtn=$('#clearBtn'),exportBtn=$('#exportBtn'),importBtn=$('#importBtn'),importFile=$('#importFile');
const adminMsg=$('#adminMsg'),allTableWrap=$('#allTableWrap'),deliveredWrap=$('#deliveredWrap');
const adminFilterPhone=$('#adminFilterPhone'),adminFilterBtn=$('#adminFilterBtn'),adminFilterClearBtn=$('#adminFilterClearBtn');
let currentFilter='';

function addItem({phone,track,price,qty,status,date}){
if(!phone) return{ok:false,msg:'–£—Ç–∞—Å —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π'};
if(!track) return{ok:false,msg:'–¢—Ä–∞–∫ –∫–æ–¥ —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π'};
if(!qty) return{ok:false,msg:'–®–∏—Ä—Ö—ç–≥ —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π'};
if(!date) return{ok:false,msg:'–û–≥–Ω–æ–æ —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π'};
if(status==='–ú–æ–Ω–≥–æ–ª–¥ –∏—Ä—Å—ç–Ω'&&(!price&&price!==0)) return{ok:false,msg:'–ú–æ–Ω–≥–æ–ª–¥ –∏—Ä—Å—ç–Ω “Ø–µ–¥ “Ø–Ω—ç –æ—Ä—É—É–ª–Ω–∞ —É—É'};
const db=loadDB();
if(!db[phone]) db[phone]=[];
const item={id:crypto.randomUUID?.()??('id_'+Date.now()),phone,track,price:Number(price)||0,qty:Number(qty)||1,status,date,createdAt:new Date().toISOString()};
db[phone].push(item); saveDB(db); return{ok:true,item}
}

function deleteItem(phone,id){const db=loadDB();if(!db[phone])return;db[phone]=db[phone].filter(x=>x.id!==id);if(db[phone].length===0) delete db[phone];saveDB(db)}
function updateItem(phone,id,patch){const db=loadDB();const arr=db[phone]||[];const i=arr.findIndex(x=>x.id===id);if(i>-1){arr[i]={...arr[i],...patch};saveDB(db);return true}return false}

function renderAll(){
const db=loadDB();const rows=[];
Object.keys(db).sort().forEach(phone=>{
if(currentFilter && !phone.includes(currentFilter)) return;
db[phone].forEach(it=>{
rows.push(`<tr>
<td>${phone}</td><td>${it.track}</td><td>‚ÇÆ ${fmt.format(it.price||0)}</td><td>${it.qty}</td><td>${it.status}</td><td>${it.date}</td>
<td><button data-act="edit" data-phone="${phone}" data-id="${it.id}">‚úèÔ∏è</button>
<button data-act="del" data-phone="${phone}" data-id="${it.id}">üóëÔ∏è</button>
<button data-act="mark" data-phone="${phone}" data-id="${it.id}">${it.status==='—Ö“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω'?'‚Ü∫ –ë—É—Ü–∞–∞—Ö':'‚úî –•“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω'}</button></td></tr>`);})
});
if(rows.length===0){allTableWrap.innerHTML='<div class="muted small">–ë“Ø—Ä—Ç–≥—ç–ª –æ–ª–¥—Å–æ–Ω–≥“Ø–π</div>';return;}
allTableWrap.innerHTML=`<table><thead><tr><th>–£—Ç–∞—Å</th><th>–¢—Ä–∞–∫</th><th>“Æ–Ω—ç</th><th>–®–∏—Ä—Ö—ç–≥</th><th>–°—Ç–∞—Ç—É—Å</th><th>–û–≥–Ω–æ–æ</th><th>“Æ–π–ª–¥—ç–ª</th></tr></thead><tbody id="allBody">${rows.join('')}</tbody></table>`;
document.getElementById('allBody').addEventListener('click',(e)=>{const btn=e.target.closest('button');if(!btn)return;const act=btn.dataset.act,phone=btn.dataset.phone,id=btn.dataset.id;if(act==='del'){if(confirm('–£—Å—Ç–≥–∞—Ö —É—É?')){deleteItem(phone,id);renderAll();renderDelivered()}};if(act==='edit'){const db=loadDB();const it=(db[phone]||[]).find(x=>x.id===id);if(!it)return;const newPrice=prompt('“Æ–Ω—ç (‚ÇÆ)',it.price)??it.price;const newQty=prompt('–®–∏—Ä—Ö—ç–≥',it.qty)??it.qty;const newStatus=prompt('–°—Ç–∞—Ç—É—Å (—ç—Ä—ç—ç–Ω–¥ –∏—Ä—Å—ç–Ω/–ú–æ–Ω–≥–æ–ª–¥ –∏—Ä—Å—ç–Ω/—Ö“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω)',it.status)??it.status;const newDate=prompt('–û–≥–Ω–æ–æ',it.date)??it.date;updateItem(phone,id,{price:Number(newPrice)||0,qty:Number(newQty)||1,status:newStatus,date:newDate});renderAll();renderDelivered()};if(act==='mark'){const db=loadDB();const it=(db[phone]||[]).find(x=>x.id===id);if(!it)return;updateItem(phone,id,{status:it.status==='—Ö“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω'?'—ç—Ä—ç—ç–Ω–¥ –∏—Ä—Å—ç–Ω':'—Ö“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω'});renderAll();renderDelivered()}})}
function renderDelivered(){
const db=loadDB();const rows=[];
Object.keys(db).forEach(phone=>db[phone].filter(x=>x.status==='—Ö“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω').forEach(it=>{
rows.push(`<div class="card small" style="padding:6px;margin-bottom:4px">–£—Ç–∞—Å: ${phone}, –¢—Ä–∞–∫: ${it.track}, –û–≥–Ω–æ–æ: ${it.date}</div>`)}))
if(rows.length===0){deliveredWrap.innerHTML='<div class="muted small">–•“Ø–ª—ç—ç–∂ –∞–≤—Å–∞–Ω –∏–ª–≥—ç—ç–º–∂ –∞–ª–≥–∞</div>';return;}
deliveredWrap.innerHTML=rows.join('')
}

// Events
adminLoginBtn.addEventListener('click',()=>{if(adminPass.value===PASS){adminArea.hidden=false;adminLogin.hidden=true;adminMsg.textContent='–ù—ç–≤—Ç—ç—Ä–ª—ç—ç';renderAll();renderDelivered()}else{adminMsg.textContent='–ù—É—É—Ü –±—É—Ä—É—É'}})

addBtn.addEventListener('click',()=>{
const r=addItem({phone:aPhone.value.trim(),track:aTrack.value.trim(),price:aPrice.value.trim(),qty:aQty.value.trim(),status:aStatus.value, date:aDate.value});adminMsg.textContent=r.msg||'';if(r.ok){renderAll();renderDelivered()}})
clearBtn.addEventListener('click',()=>{aPhone.value='';aTrack.value='';aPrice.value='';aQty.value='';aDate.value='';aStatus.value='—ç—Ä—ç—ç–Ω–¥ –∏—Ä—Å—ç–Ω'})
exportBtn.addEventListener('click',()=>{const blob=new Blob([JSON.stringify(loadDB(),null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='cargo_db.json';a.click();URL.revokeObjectURL(url)})
importBtn.addEventListener('click',()=>{importFile.click()})
importFile.addEventListener('change',()=>{const f=importFile.files[0];if(!f)return;const reader=new FileReader();reader.onload=e=>{try{const obj=JSON.parse(e.target.result);saveDB(obj);renderAll();renderDelivered();alert('–ò–º–ø–æ—Ä—Ç –∞–º–∂–∏–ª—Ç—Ç–∞–π')}catch(err){alert('–§–∞–π–ª –±—É—Ä—É—É')}};reader.readAsText(f)})

adminFilterBtn.addEventListener('click',()=>{currentFilter=adminFilterPhone.value.trim();renderAll()})
adminFilterClearBtn.addEventListener('click',()=>{adminFilterPhone.value='';currentFilter='';renderAll()})

document.getElementById('yr').textContent=new Date().getFullYear();
ensureDB();
</script>
</body>
</html>
